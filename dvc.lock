parse_train:
  cmd: python3 -m purano.run_parse --inputs data/documents/ru_tg_0525.jsonl --fmt
    jsonl --output-file output/train_parsed.db --cleaner-config configs/cleaner.jsonnet
  deps:
  - path: data/documents/ru_tg_0525.jsonl
    md5: 6713a796a0f2d50a7ec63a744b68eee1
  - path: purano/run_parse.py
    md5: 9b6d334316d2a3f654949d413ac7d15f
  params:
    configs/cleaner.jsonnet:
      cat_detect_model_path: models/cat_detect/ru_cat_v5.ftz
      is_lower: true
      is_news_only: true
      is_russian_only: true
      lang_detect_model_path: models/lang_detect/lang_detect_v10.ftz
  outs:
  - path: output/train_parsed.db
    md5: 73806e15e4e41285075c3f5c4a6d8ef5
annotate_train:
  cmd: python3 -m purano.run_annotate --config configs/annotator.jsonnet --reannotate
    --sort-by-date --output-file output/train_annotated.db --input-file output/train_parsed.db
  deps:
  - path: configs/annotator.jsonnet
    md5: 9a4f379505eb53f5a153d438f114db5c
  - path: output/train_parsed.db
    md5: 73806e15e4e41285075c3f5c4a6d8ef5
  - path: purano/run_annotate.py
    md5: 054645ecf679834a8cad348d1dae1ba6
  outs:
  - path: output/train_annotated.db
    md5: ead1158192ea87e48d4a06dac9f76fe1
clustering_train:
  cmd: python3 -m purano.run_clustering --config configs/clusterer.jsonnet --sort-by-date
    --output-file output/clusters.json --input-file output/train_annotated.db
  deps:
  - path: output/train_annotated.db
    md5: ead1158192ea87e48d4a06dac9f76fe1
  - path: purano/clusterer/clusterer.py
    md5: 08a93e9909a669bdf6df9b97ed9c3847
  - path: purano/run_clustering.py
    md5: 85ed83c3511d05ca464f42b56aa2bdd4
  params:
    configs/clusterer.jsonnet:
      clustering_params.affinity: precomputed
      clustering_params.distance_threshold: 0.36
      clustering_params.linkage: average
      clustering_params.n_clusters:
      clustering_type: agglomerative
      embeddings.aggregation: concat
      embeddings.keys:
      - text_linear_fasttext_embedding
      - title_linear_fasttext_embedding
      embeddings.weights:
      - 1.0
      - 1.0
      entities_key: title_slovnet_ner
      fix_hosts: true
      fix_time: false
      hosts_penalty: 5.0
      time_penalty: 4.0
  outs:
  - path: output/clusters.json
    md5: afefe0e6a4fb6f798907ee63ced3b06d
evaluate_train:
  cmd: python3 -m purano.run_evaluate --clustering-markup data/markup/ru_clustering_0525.tsv
    --original-json data/documents/ru_tg_0525.jsonl --threads-json output/clusters.json
    --output-json output/metrics.json
  deps:
  - path: data/documents/ru_tg_0525.jsonl
    md5: 6713a796a0f2d50a7ec63a744b68eee1
  - path: data/markup/ru_clustering_0525.tsv
    md5: 87705bb85e7e4a96662a6af85350f063
  - path: output/clusters.json
    md5: afefe0e6a4fb6f798907ee63ced3b06d
  - path: purano/run_evaluate.py
    md5: bd4fcd1b62016bcf41d55218806b4a91
  outs:
  - path: output/metrics.json
    md5: 32170680c80eb4c98aa00043e6f9dbc5
