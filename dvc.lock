parse_train:
  cmd: python3 -m purano.run_parse --inputs data/documents/ru_tg_0525.jsonl --fmt
    jsonl --output-file output/train_parsed.db --cleaner-config configs/cleaner.jsonnet
  deps:
  - path: data/documents/ru_tg_0525.jsonl
    md5: 6713a796a0f2d50a7ec63a744b68eee1
  - path: purano/run_parse.py
    md5: 9b6d334316d2a3f654949d413ac7d15f
  params:
    configs/cleaner.jsonnet:
      cat_detect_model_path: models/cat_detect/ru_cat_v5.ftz
      is_lower: true
      is_news_only: true
      is_russian_only: true
      lang_detect_model_path: models/lang_detect/lang_detect_v10.ftz
  outs:
  - path: output/train_parsed.db
    md5: 73806e15e4e41285075c3f5c4a6d8ef5
annotate_train:
  cmd: python3 -m purano.run_annotate --config configs/annotator.jsonnet --reannotate
    --sort-by-date --output-file output/train_annotated.db --input-file output/train_parsed.db
  deps:
  - path: configs/annotator.jsonnet
    md5: dcef7ba3d86f8426bc89f013bcea6c0d
  - path: output/train_parsed.db
    md5: 73806e15e4e41285075c3f5c4a6d8ef5
  - path: purano/run_annotate.py
    md5: 054645ecf679834a8cad348d1dae1ba6
  outs:
  - path: output/train_annotated.db
    md5: 318f6c3d3a7cb794a7a0d1eafe798cc2
clustering_train:
  cmd: python3 -m purano.run_clustering --config configs/clusterer.jsonnet --sort-by-date
    --output-file output/clusters.json --input-file output/train_annotated.db
  deps:
  - path: output/train_annotated.db
    md5: 318f6c3d3a7cb794a7a0d1eafe798cc2
  - path: purano/run_clustering.py
    md5: 505cc6c59ef9598b2e7cca2ad82af4b3
  params:
    configs/clusterer.jsonnet:
      clustering_params.affinity: precomputed
      clustering_params.distance_threshold: 0.08
      clustering_params.linkage: average
      clustering_params.n_clusters:
      clustering_type: agglomerative
      embedding_key: title_fasttext_embedding
      entities_key: title_slovnet_ner
      fix_hosts: true
      hosts_penalty: 5.0
  outs:
  - path: output/clusters.json
    md5: 94117beea6bf41722c8e38c584fb47a8
evaluate_train:
  cmd: python3 -m purano.run_evaluate --clustering-markup data/markup/ru_clustering_0525.tsv
    --original-json data/documents/ru_tg_0525.jsonl --threads-json output/clusters.json
    --output-json output/metrics.json
  deps:
  - path: data/documents/ru_tg_0525.jsonl
    md5: 6713a796a0f2d50a7ec63a744b68eee1
  - path: data/markup/ru_clustering_0525.tsv
    md5: 87705bb85e7e4a96662a6af85350f063
  - path: output/clusters.json
    md5: 94117beea6bf41722c8e38c584fb47a8
  - path: purano/run_evaluate.py
    md5: 198bfae25ca09a842b71213a306db298
  outs:
  - path: output/metrics.json
    md5: d2d7f7b1128a1194dfe53db71b4f64f7
